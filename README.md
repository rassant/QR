

### Набор не связанных заметок чисто для себя



Для работы использовал:

libexiv2-dev  (для работы с EXIF что бы определить автора фото, или ориентацию фото) g++ main.cpp -o my_program -lexiv2
libboost-all-dev ( для работы с контрольной суммой )
sudo apt-get install libqrencode-dev ( для работы с QRcode)
sudo apt-get install libgsl-dev ( для работы с argv[0]) #include <gsl/span>

компиляция qrencode
g++ -std=c++17 -O2 -Wall main.cpp -o processor \
    $(pkg-config --cflags --libs opencv4) \
    -lqrencode




c отслеживаемой папки копируем на сервер и в архив. Затем в оригинал добавляем QRcode
вначале мне надо локально фото скинуть к себе на комп и потом уже на сервер. 
Сделать проверку что фото загрузились и если что при входе с компа дома, фотки должны загурзиться автоматически.
перед копированием сжать файл.
   
   




### Работа программы ###

- При попадании в папку файла с фотографией.
Файл копируется на удаленный сервер.
Создается ссылка где лежит этот файл на сервере. 
на основании этой ссылки генерируется QRcode  
                https://fukuchi.org/works/qrencode/
                https://github.com/zxing-cpp/zxing-cpp?tab=readme-ov-file
далее этот QRcode размещается на файле с фотографией котую мы в самом начале скопировали на удаленный сервер.



-----------------------------------------------------------------------------------------------------

# FileWatcher 

**Задача**  : Отслеживает появление новых файлов (фото) в заданной локальной папке.

Функционал:
    - Запуск мониторинга (в отдельном потоке или через системные события).
    - При появлении нового файла сигнализировать в основной цикл (callback/событие).
Реализация:
    - Windows: функции `FindFirstChangeNotification`, 
                       `FindNextChangeNotification`, 
                       или библиотеки (например, Win32 API, ReadDirectoryChangesW).
                       https://learn.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-readdirectorychangesw
                       https://cppcodetips.wordpress.com/2019/07/26/file-system-watcher-in-c-for-windows/
    - Linux/Unix: inotify или готовые обёртки (Boost.FileSystem не умеет нативно «слушать» изменения, но может помочь с обходом директорий; для событий есть сторонние библиотеки).
    - Кроссплатформенные библиотеки: filesystem-watcher или подобные.
      https://solarianprogrammer.com/2019/01/13/cpp-17-filesystem-write-file-watcher-monitor/


-----------------------------------------------------------------------------------------------------

# Uploader  (или NetworkManager)

**Задача**: Копирует файл на удалённый сервер и возвращает URL (или путь на сервере).

Функционал:
    - Принимает на вход путь к локальному файлу.
    - Загружает его на сервер (SFTP, FTP, HTTP POST и т.д.).
    - Возвращает ссылку вида http://<server>/images/<filename>.jpg или аналогичную.
Возможные реализации:
    - libcurl: Умеет FTP, SFTP, HTTP/HTTPS-запросы. Универсальная и достаточно популярная библиотека.
    - libssh2: Если нужно именно SFTP/SSH.
    - Boost.Beast: Для HTTP (чаще для реализации серверной части, но можно и клиентом использовать).


-----------------------------------------------------------------------------------------------------

# QrCodeGenerator #

**Задача**: По заданной строке (URL) генерирует изображение QR-кода.

Функционал:
    - Принимает строку (ссылку).
    - Создаёт битмап/изображение QR-кода. Сохраняет его во временный файл или возвращает в памяти (в виде массива пикселей).
библиотеки:
    - zxing-cpp – кроссплатформенная библиотека для работы со штрихкодами/QR-кодами (есть и генерация, и считывание).
      [zxing-cpp ](https://github.com/zxing-cpp/zxing-cpp)
    - libqrencode – специализированна на генерации QR-кодов.
      [libqrencode](https://fukuchi.org/works/qrencode/)
```
Пример (zxing-cpp):
// Pseudocode
#include <QREncode.h> // или соответствующий хедер

// generateQrCode("http://example.com/image.jpg")
//    возвращает, к примеру, некий объект с данными пикселей
```


-----------------------------------------------------------------------------------------------------

# ImageProcessor

**Задача**: Наложить (встроить) QR-код на исходное фото.

Функционал:
    - Открыть исходное фото.
    - Открыть/получить сгенерированное изображение QR-кода.
    - Разместить QR-код в нужном месте (например, в правом нижнем углу).
    - Сохранить итоговый файл (локально или сразу перезаписать на сервер).

библиотеки для обработки изображений:
    - OpenCV (opencv2/imgcodecs.hpp, opencv2/imgproc.hpp).
    - ImageMagick (Magick++).
    - CImg.


-----------------------------------------------------------------------------------------------------

# main 

**Задача**: Управляет всеми перечисленными модулями.

Алгоритм (упрощённая схема):
    - Запустить FileWatcher, передав путь к папке, где появляются фото.
    - При сигнале о новом файле:
    - Вызвать Uploader и загрузить файл на сервер, получить ссылку.
    - Вызвать QrCodeGenerator, передав ссылку.
    - Полученный QR-код наложить с помощью ImageProcessor на исходное фото.
    - Повторять процесс для каждого нового файла.

================================================================================================================

## РЕСУРСЫ ##

Мониторинг папки
**inotify** 
    https://habr.com/ru/articles/782742/
    https://github.com/erikzenker/inotify-cpp

**Копирование/загрузка на удалённый сервер**
    [libcurl](https://curl.se/libcurl/) – универсальный вариант (поддерживает FTP, SFTP, HTTP POST и т.п.).
    [libssh2](https://libssh2.org/) – SFTP по SSH напрямую.

**Генерация QR-кода**
    zxing-cpp (есть версии под разные платформы, умеет и декодировать, и кодировать).
    libqrencode – более простая в плане генерации.

**Обработка изображений (наложение QR-кода)**
    [OpenCV](https://opencv.org/) – мощная и популярная библиотека, с которой легко работать с пикселями, накладывать одно изображение на другое, изменять размер и т.д.
    [Magick++](https://imagemagick.org/) (часть ImageMagick) – также хорошо подходит для манипуляций с изображениями.



-------------------------------------
### Ключевые моменты при реализации ###

Обработка ошибок (что делать, если сервер недоступен, файл не загрузился и т.д.).
Валидация и логирование.
Параметры (сервер, директория, формат файла) брать из настроек (конфигурационного файла).
многопоточность, очереди заданий, если фотографий много

**Надёжность загрузки:**
    Возможно, потребуется несколько попыток загрузить один и тот же файл, если соединение с сервером нестабильно.
    Проверять размер загруженного файла, MD5-хеш и т.п., если критично.
**Разрешения/права на запись в мониторимую папку:**
    Убедиться, что программа имеет доступ на чтение.
**Оптимизация (если файлов много):**
    Обрабатывать файлы в отдельном рабочем потоке, чтобы не блокировать мониторинг.
    Использовать очереди (queue) заданий и пул потоков.
**Безопасность:**
    Если отправляете по HTTP, убедитесь, что данные не слишком критичные (иначе HTTPS).
    SFTP/SSH – более безопасный вариант.
**Формирование ссылки:**
    Может быть динамическим (через REST API на сервере) или простым (если это FTP/HTTP и каталог общедоступен).
    Если требуется, чтобы файл был доступен внешне, убедитесь, что каталог правильно проксируется/открыт через веб-сервер (nginx, Apache).
**Встраивание QR-кода:**
    Часто удобнее генерировать и накладывать QR-код локально, а на сервер загружать уже финальное изображение (если это соответствует бизнес-логике).
    Либо сначала загружаем изображение, получаем ссылку, генерируем QR, накладываем локально и снова грузим новое изображение. Логика может различаться в зависимости от требований.


--------------------------------------------------------------------------






-------------------------------------------------------------------------------
Установка на видоус

### Для доступа к инфо фото
.\vcpkg install exiv2
.\vcpkg install opencv
.\vcpkg install boost
.\vcpkg install libqrencode


cmake -DCMAKE_TOOLCHAIN_FILE=D:/GitHub/vcpkg/scripts/buildsystems/vcpkg.cmake ..
cmake --build . --config Release

-------------------------------------------------------------

NEOVIM NEOVIM NEOVIM NEOVIM NEOVIM NEOVIM NEOVIM NEOVIM NEOVIM NEOVIM NEOVIM NEOVIM NEOVIM NEOVIM NEOVIM NEOVIM 

# Настройка neovim для windows
git clone https://github.com/microsoft/vcpkg.git
cd vcpkg
.\bootstrap-vcpkg.bat
   
### Установка LUa
.\vcpkg search LUa
https://github.com/LuaLS/lua-language-server/releases/download/3.13.5/lua-language-server-3.13.5-win32-x64.zip
   
   
### scoop
https://scoop.sh/
Откройте терминал PowerShell (версия 5.1 или более поздняя) и в командной строке

Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
Invoke-RestMethod -Uri https://get.scoop.sh | Invoke-Expression

scoop install lua-language-server

### nsp
https://nodejs.org/en

### clangd
файл конфигурации:
Windows: %LocalAppData%\clangd\config.yaml, как правило C:\Users\Bob\AppData\Local\clangd\config.yaml.
-------------------------------------------------------------

